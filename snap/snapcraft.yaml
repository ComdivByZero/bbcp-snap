name: bbcb
title: BlackBox IDE
base: core18
version: '1.7.2~b1'
license: BSD-2-Clause
icon: snap/gui/blackbox.svg
summary: BlackBox Component Builder - Component Pascal IDE
description: |
  BlackBox Component Builder is an open-source IDE and a framework (collection of modules)
  written in the programming language Component Pascal which is a superset of the language
  Oberon-2 developed by Niklaus Wirth. BlackBox provides facilities for document creation,
  program compilation, module execution, and interface design. Component Pascal is module
  based. Each module is a unit of compilation and a unit of execution. There is no explicit
  linker. Modules are brought into memory when specified. There is no need for "header"
  files. Symbol files are automatically generated by the compiler for those elements of a
  module that are specifically marked to be exported.
  .
  The component classes (e.g. for text or form components) follow the principle of black box
  inheritance (interface inheritance instead of implementation inheritance), hence the name
  "BlackBox".
  .
  The compiler is very fast. The language is strongly typed. Data structures are automatically
  garbage collected when no longer referenced. The framework comes with a complete set of
  documents explaining the meaning and use of each module.

grade: devel
confinement: strict

architectures:
  - build-on: amd64

parts:
  i386:
    plugin: nil
    source: .
    override-build: |
      dpkg --add-architecture i386
      apt update

  desktop-gtk2:
    after: [i386]
    source: https://github.com/ubuntu/snapcraft-desktop-helpers.git
    source-subdir: gtk
    override-pull: |
      snapcraftctl pull
      git apply $HOME/parts/i386/build/snap/local/snapcraft-desktop-helpers.patch
    plugin: make
    make-parameters:
      - "FLAVOR=gtk2"
      - "CFLAGS=-m32"
      - "LIB_DIR=usr/lib/i386-linux-gnu"
      - "CODE_AFTER_INIT='ARCH=i386-linux-gnu'"
    build-packages:
      - build-essential
      - libgtk2.0-dev
      - gcc-multilib
    stage-packages:
      - libxkbcommon0:i386  # XKB_CONFIG_ROOT
      - ttf-ubuntu-font-family
      - dmz-cursor-theme
      - light-themes:i386
      - adwaita-icon-theme
      - gnome-themes-standard
      - shared-mime-info:i386
      - libgtk2.0-0:i386
      - libgdk-pixbuf2.0-0:i386
      - libglib2.0-bin:i386
      - libgtk2.0-bin:i386
      - unity-gtk2-module:i386
      - locales-all
      - libappindicator1:i386
      - xdg-user-dirs
      - ibus-gtk:i386
      - libibus-1.0-5:i386
      - gnome-themes-extra:i386

  blackbox:
    after: [desktop-gtk2]
    source: https://github.com/bbcb/bbcp.git
    plugin: nil
    override-build: |
      cd BlackBox
      ./switch-target Linux GUI
      ./build
      ./export $SNAPCRAFT_PART_INSTALL/usr/lib/blackbox || true # TODO fix BlackBox absense error
      cd ..
    build-packages:
      - pax
      - libgtk2.0-dev
    stage-packages:
      - libgtk2.0-0:i386
      - gtk2-engines:i386
      - gtk2-engines-murrine:i386
      - libcanberra-gtk-module:i386
      - libgdk-pixbuf2.0-0:i386
      - gnome-themes-extra:i386
      - shared-mime-info:i386
      - gtk2-engines-pixbuf
    stage:
      - -usr/bin/update-mime-database
      - -usr/share/doc/shared-mime-info/shared-mime-info-spec.pdf

  russian:
    after: [blackbox]
    source: https://github.com/bbcb/russian.git
    plugin: nil
    override-build: |
      mkdir -p $SNAPCRAFT_PART_INSTALL/usr/lib/blackbox
      cp -r * $SNAPCRAFT_PART_INSTALL/usr/lib/blackbox/
      cd $SNAPCRAFT_PART_INSTALL/usr/lib/blackbox
      rm README links.sh make-deb.sh

apps:
  bbcb:
    command: desktop-launch $SNAP/usr/lib/blackbox/run-BlackBox
    environment:
      LC_ALL: "C.UTF-8"
      DISABLE_WAYLAND: 1
    plugs:
      - home
      - account-control
      - desktop
      - desktop-legacy
      - x11
      - unity7
      - network
      - gsettings
      - mount-observe
      - network-control

plugs:
  gtk-2-engines:
    interface: content
    target: $SNAP/lib/i386-linux-gnu/gtk-2.0
    default-provider: gtk2-common-themes
  gtk-2-themes:
    interface: content
    target: $SNAP/share/themes
    default-provider: gtk-common-themes
  icon-themes:
    interface: content
    target: $SNAP/share/icons
    default-provider: gtk-common-themes
  sound-themes:
    interface: content
    target: $SNAP/share/sounds
    default-provider: gtk-common-themes
